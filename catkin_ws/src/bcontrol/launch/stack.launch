<launch>
  <arg name="platform" doc="The environment of the launch site. `sim` or `robot`" />
  <group unless="$(eval arg('platform') in ['sim', 'robot'])">
    <node pkg="bcontrol" type="terminate.py" name="terminate" output="screen" args="'Invalid argument: platform'" required="true" />
  </group>
  <arg name="enable_detector" default="true" doc="Enable the detector node" />

  <!-- Launch the controller -->
  <node pkg="bcontrol" type="controller.py" name="bcontrol_node" output="screen"/>

  <!-- Launch the planner -->
  <node pkg="bcontrol" type="planner.py" name="bplan_node" output="screen"/>

  <!-- Launch the detector -->
  <include file="$(find bcontrol)/launch/detector.launch" if="$(eval arg('enable_detector'))">
    <arg name="platform" value="$(arg platform)" />
  </include>

  <!-- EKF (local) -->
  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_localization_local" required="true">
    <rosparam command="load" file="$(find bcontrol)/config/robot_localization.local.sim.yaml" if="$(eval arg('platform') == 'sim')" />
    <rosparam command="load" file="$(find bcontrol)/config/robot_localization.local.robot.yaml" if="$(eval arg('platform') == 'robot')" />
    <remap from="odometry/filtered" to="/odometry/local_filtered" />
  </node>
</launch>